% Environment setup
% -----------------
% Module use
%  INTEGER, PUBLIC, PARAMETER  :: fp = SELECTED_REAL_KIND(15)
DEGREES_TO_RADIANS = pi/180.0;
transmittance_limit_lower = 0.00001;
transmittance_limit_upper = 0.9999;

%
e0_4 = 0.0088419;         % Value used in FASTEM-4
e0_5 = 0.00885418781762;  % from Paul van Delst (used in FASTEM-5)
% minimum and maximum frequency
min_f = 1.4;
max_f = 200.0;
% minimum and maximum wind speed
min_wind = 0.3;
max_wind = 35.0;

% The fitting coefficients for the JCSDA permittivity model
% see the ref. (An Improved Fast Microwave Sea Surface Emissivity Model, FASTEM4,
% Technical Report, UK Met. Office)
A_COEF = [3.8,0.0248033,87.9181727, ...
    -0.4031592248,    0.0009493088010,  -0.1930858348E-05, -0.002697,...
    -7.3E-06,        -8.9E-06,           5.723,             0.022379,...
    -0.00071237,     -6.28908E-03,     1.76032E-04,        -9.22144E-05,...
    0.1124465,      -0.0039815727,    0.00008113381,      -0.00000071824242,...
    -2.39357E-03,     3.1353E-05,       -2.52477E-07,       0.003049979018,...
    -3.010041629E-05, 0.4811910733E-05, -0.4259775841E-07,  0.149,...
    -8.8E-04,        -1.05E-04,          2.033E-02,         1.266E-04,...
    2.464E-06,      -1.849E-05,         2.551E-07,        -2.551E-08,...
    0.182521,       -1.46192E-03,       2.09324E-05,      -1.28205E-07];%39

% fitting coefficients for the large-scale correction - FASTEM-5
Lcoef5 = [ ...
    -5.994667E-02, 9.341346E-04,-9.566110E-07, 8.360313E-02,-1.085991E-03, ...
    6.735338E-07,-2.617296E-02, 2.864495E-04,-1.429979E-07,-5.265879E-04, ...
    6.880275E-05,-2.916657E-07,-1.671574E-05, 1.086405E-06,-3.632227E-09, ...
    1.161940E-04,-6.349418E-05, 2.466556E-07,-2.431811E-02,-1.031810E-03, ...
    4.519513E-06, 2.868236E-02, 1.186478E-03,-5.257096E-06,-7.933390E-03, ...
    -2.422303E-04, 1.089605E-06,-1.083452E-03,-1.788509E-05, 5.464239E-09, ...
    -3.855673E-05, 9.360072E-07,-2.639362E-09, 1.101309E-03, 3.599147E-05, ...
    -1.043146E-07 ];

% fitting coefficients for the large-scale correction - FASTEM-4
Lcoef4 = [ ...
    -9.197134E-02, 8.310678E-04,-6.065411E-07, 1.350073E-01,-1.032096E-03, ...
    4.259935E-07,-4.373322E-02, 2.545863E-04, 9.835554E-08,-1.199751E-03, ...
    1.360423E-05,-2.088404E-08,-2.201640E-05, 1.951581E-07,-2.599185E-10, ...
    4.477322E-04,-2.986217E-05, 9.406466E-08,-7.103127E-02,-4.713113E-05, ...
    1.754742E-06, 9.720859E-02, 1.374668E-04,-2.591771E-06,-2.687455E-02, ...
    -3.677779E-05, 7.548377E-07,-3.049506E-03,-5.412826E-05, 2.285387E-07, ...
    -2.201640E-05, 1.951581E-07,-2.599185E-10, 2.297488E-03, 3.787032E-05, ...
    -1.553581E-07 ];


% fitting coefficients for the small-scale correction
Scoef = [ ...
    -5.0208480E-06,   2.3297951E-08,   4.6625726E-08,  -1.9765665E-09, ...
    -7.0469823E-04,   7.5061193E-04,   9.8103876E-04,   1.5489504E-04 ];

% August 3, 2011
% 0.5
% fitting coefficients for the downward radiation using transmittance - FASTEM-5
t_c5 = [ ...
    0.199277E+00, 0.166155E+00, 0.153272E-01, 0.399234E+01,-0.130968E+01, ...
    -0.874716E+00,-0.169403E+01,-0.260998E-01, 0.540443E+00,-0.282483E+00, ...
    -0.219994E+00,-0.203438E-01, 0.351731E+00, 0.208641E+01,-0.693299E+00, ...
    0.867861E-01, 0.619020E-01, 0.595251E-02,-0.475191E+01,-0.430134E-01, ...
    0.248524E+01, 0.388242E-01, 0.194901E+00,-0.425093E-01, 0.607698E+01, ...
    -0.313861E+01,-0.103383E+01,-0.377867E+01, 0.180284E+01, 0.699556E+00, ...
    -0.506455E-01,-0.262822E+00, 0.703056E-01, 0.362055E+01,-0.120318E+01, ...
    -0.124971E+01, 0.154014E-01, 0.759848E-01,-0.268604E-01,-0.802073E+01, ...
    0.324658E+01, 0.304165E+01, 0.100000E+01, 0.200000E-01, 0.300000E+00 ];

% fitting coefficients for the downward radiation using transmittance - FASTEM-4
t_c4 = [ ...
    -0.675700E-01, 0.214600E+00,-0.363000E-02, 0.636730E+01, 0.900610E+00, ...
    -0.524880E+00,-0.370920E+01,-0.143310E+01, 0.397450E+00, 0.823100E-01, ...
    -0.255980E+00, 0.552000E-02, 0.208000E+01, 0.244920E+01,-0.456420E+00, ...
    -0.224900E-01, 0.616900E-01,-0.344000E-02,-0.507570E+01,-0.360670E+01, ...
    0.118750E+01, 0.124950E+00, 0.121270E+00, 0.714000E-02, 0.736620E+01, ...
    -0.114060E+00,-0.272910E+00,-0.504350E+01,-0.336450E+00, 0.161260E+00, ...
    -0.154290E+00,-0.141070E+00,-0.809000E-02, 0.395290E+01, 0.958580E+00, ...
    -0.159080E+00, 0.368500E-01, 0.307100E-01, 0.810000E-03,-0.619960E+01, ...
    -0.172580E+01, 0.641360E+00, 0.100000E+01, 0.200000E-01, 0.300000E+00 ];

% fitting coefficients for the azimuth dependence, S1 and S4 trained by
b_coef = [ ...
    3.307255E-04,-2.901276E-06,-1.475497E-04, 1.288152E-06, 1.004010E-04, ...
    -2.671158E-07, 4.363154E-06,-9.817795E-09,-4.777876E-05, 3.051852E-08, ...
    1.369383E-03,-2.215847E-05,-8.099833E-04, 1.767702E-05,-5.977649E-06, ...
    -1.784656E-07,-9.355531E-07, 5.495131E-08,-3.479300E-05,-3.751652E-07, ...
    2.673536E-04,-1.378890E-06,-8.660113E-05, 2.871488E-07, 1.361118E-05, ...
    -1.622586E-08,-1.232439E-07,-3.067416E-09,-1.835366E-06, 8.098728E-09, ...
    1.255415E-04,-5.145201E-07,-8.832514E-06,-5.105879E-09, 2.734041E-05, ...
    -3.398604E-07, 3.417435E-06,-7.043251E-09, 1.497222E-05,-6.832110E-09, ...
    -2.315959E-03,-1.023585E-06, 5.154471E-05, 9.534546E-06,-6.306568E-05, ...
    -4.378498E-07,-2.132017E-06, 1.612415E-08,-1.929693E-06,-6.217311E-09, ...
    -1.656672E-04, 6.385099E-07, 2.290074E-06, 1.103787E-07,-5.548757E-06, ...
    5.275966E-08,-4.653774E-07, 1.427566E-09,-3.197232E-06,-4.048557E-09, ...
    -1.909801E-04,-3.387963E-07, 4.641319E-05, 4.502372E-07,-5.055813E-05, ...
    2.104201E-07,-4.121861E-06,-1.633057E-08,-2.469888E-05, 4.492103E-08, ...
    -4.582853E-03,-5.373940E-06, 9.713047E-04, 1.783009E-05,-4.539091E-04, ...
    7.652954E-07,-6.708905E-06, 2.148401E-08, 8.054350E-05, 3.069258E-07, ...
    -6.405746E-05,-9.694284E-08, 1.914498E-05, 1.336975E-07,-4.561696E-06, ...
    3.769169E-08,-6.105244E-07, 2.433761E-10,-3.961735E-06, 1.995636E-08, ...
    1.350148E-06, 3.678149E-07, 1.261701E-05,-2.011440E-07,-2.361347E-05, ...
    2.943147E-08,-1.304551E-07,-1.119368E-09, 8.469458E-06,-2.292171E-09, ...
    1.419156E-03,-3.838338E-06, 8.222562E-05,-1.106098E-06,-5.482327E-05, ...
    3.083137E-07, 4.418828E-06,-1.302562E-08, 3.768883E-05,-5.012753E-08, ...
    -9.396649E-06, 2.764698E-07, 1.745336E-05,-1.427031E-07,-3.879930E-06, ...
    -1.117458E-08, 5.688281E-08, 1.513582E-09, 6.778764E-06,-7.691286E-09 ];

% Frequency-dependent azimuth correction
x = [ 0.0, 1.4, 6.8, 10.7, 19.35, ...
    37., 89., 150., 200.];
y = [ 0.0, 0.1, 0.6, 0.9, 1., ...
    1.0, 0.4, 0.2, 0.0];

% Coefficients for M.Kazumori azimuth model function (FASTEM-6)
coef_mk_azi = reshape( [ ...
    4.401E-02, -1.636E+01,  1.478E+00, -4.800E-02,  3.202E-06, -6.002E-05,...    % 06V OK
    4.379E-02, -1.633E+01,  1.453E+00, -4.176E-02,  5.561E-06, -4.644E-05,...    % 10V OK
    5.009E-02, -1.638E+01,  1.520E+00, -3.994E-02,  1.330E-05,  1.113E-05,...    % 19V OK
    5.165E-02, -1.638E+01,  1.543E+00, -4.066E-02,  1.494E-05,  1.010E-05,...    % 23V interpolated
    5.553E-02, -1.638E+01,  1.602E+00, -4.246E-02,  1.903E-05,  7.524E-06,...    % 37V OK
    -9.131E-05,  1.251E+00,  6.769E-01, -2.913E-02,  1.092E+00, -1.806E-04,...    % 89V OK revised
    -1.234E-07, -8.179E-03, -1.040E+01,  4.477E-01,  0.000E+00,  3.390E-05,...    % 06H OK
    -1.938E-05, -8.007E-03, -1.039E+01,  4.610E-01,  0.000E+00,  4.419E-05,...    % 10H OK
    1.362E-04, -1.013E-03, -9.235E+00,  3.844E-01,  0.000E+00,  2.891E-04,...    % 19H OK
    1.519E-04, -7.865E-04, -9.234E+00,  3.884E-01,  0.000E+00,  6.856E-04,...    % 23H Interpolated
    1.910E-04, -2.224E-04, -9.232E+00,  3.982E-01,  0.000E+00,  1.673E-03,...    % 37H OK
    3.554E-04,  5.226E-04,  9.816E-01, -7.783E-03,  0.000E+00,  2.437E+01 ], ...% 89H OK revised
    [6,6,2]);



% --------------------------------------
% Structure definition to hold forward
% variables across FWD, TL, and AD calls
% --------------------------------------
% =============================================================
% Routine for forward model foam reflectivity
% Function dependence is on zenith angle only
% so no TL or AD routine.
% See Eqns(18.44a) (18.44b) in
%   Ulaby, F.T. et al. (1986) Microwave Remote Sensing, Active
%     and Passive, vol.3, From Theory to Applications, pp1457.
% =============================================================
FR_COEFF = ...
    [ 0.07, -1.748e-3, -7.336e-5, 1.044e-7, -0.93 ];

%save('fastem_5_coefs.mat','*')


